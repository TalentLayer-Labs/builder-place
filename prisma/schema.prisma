generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ********************* BuilderPlace *********************

model BuilderPlace {
  id                 Int          @id @default(autoincrement())
  about              String?
  aboutTech          String?
  baseline           String?
  cover              String?
  customDomain       String?      @unique
  icon               String?
  logo               String?
  name               String
  owner              User?        @relation(fields: [ownerId], references: [id])
  ownerId            Int?         @unique
  collaborators      User[]       @relation("BuilderPlaceCollaborators")
  palette            Json
  preferredWorkTypes WorkType[]
  presentation       String?
  profilePicture     String?
  status             EntityStatus @default(PENDING)
  subdomain          String?      @unique
}

model User {
  id                       Int            @id @default(autoincrement())
  about                    String?
  address                  String?        @unique
  counterStartDate         Int            @default(0)
  email                    String?        @unique
  isEmailVerified          Boolean        @default(false)
  name                     String
  picture                  String?
  status                   EntityStatus   @default(PENDING)
  talentLayerId            String?        @unique
  weeklyTransactionCounter Int            @default(0)
  workerProfile            WorkerProfile? @relation("WorkerProfile")
  hirerProfile             HirerProfile?  @relation("HirerProfile")
  ownedBuilderPlace        BuilderPlace?
  managedPlaces            BuilderPlace[] @relation("BuilderPlaceCollaborators")
  emailPreferences         Json           @default("{\"activeOnNewService\": false, \"activeOnNewProposal\": true, \"activeOnProposalValidated\": true, \"activeOnFundRelease\": true, \"activeOnReview\": true, \"activeOnPlatformMarketing\": false, \"activeOnProtocolMarketing\": true}")
}

model WorkerProfile {
  id     Int      @id
  user   User     @relation("WorkerProfile", fields: [id], references: [id])
  skills String[]
}

model HirerProfile {
  id   Int  @id
  user User @relation("HirerProfile", fields: [id], references: [id])
}

enum EntityStatus {
  PENDING
  VALIDATED
}

enum WorkType {
  BOUNTIES
  GRANTS
  GIGS
  JOBS
}

// ********************* Web3 Mail *********************

enum EmailType {
  NEW_PROPOSAL
  PROPOSAL_VALIDATED
  FUND_RELEASE
  REVIEW
  PLATFORM_MARKETING
  PROTOCOL_MARKETING
  NEW_SERVICE
}

enum EmailSender {
  IEXEC
  SENDGRID
}

model CronProbe {
  id           Int       @id @default(autoincrement())
  type         EmailType @unique
  lastRanAt    DateTime
  successCount Int
  duration     Int
  errorCount   Int
}

model Mail {
  id     String      @id
  sentAt DateTime
  type   EmailType
  sender EmailSender
}
